<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Goldzilla Macro Dashboard</title>
  <style>
    body {
      background-color: #111;
      color: #eee;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: #FFD700;
      margin-top: 80px;
    }
    .section {
      margin-bottom: 40px;
    }
  </style>
</head>
<body>

<!-- 🔁 TradingView Ticker Tape (Sticky Full Width) -->
<div class="tradingview-widget-container" id="ticker-bar">
  <div class="tradingview-widget-container__widget"></div>
  <div class="tradingview-widget-copyright">
    <a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank">
      <span class="blue-text">Track all markets on TradingView</span>
    </a>
  </div>
  <div id="debt-container"></div>

<script>
fetch("https://script.google.com/macros/s/YOUR_DEPLOYED_SCRIPT_ID/exec")
  .then(response => response.json())
  .then(data => {
    const container = document.getElementById("debt-container");
    // ...[rest of the JS from previous message]
  });
</script>

  <div id="debt-container"></div>

<script>
fetch("https://script.google.com/macros/s/YOUR_DEPLOYED_SCRIPT_ID/exec")
  .then(response => response.json())
  .then(data => {
    const container = document.getElementById("debt-container");
    // ...[rest of the JS from previous message]
  });
</script>

  <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
  {
    "symbols": [
      { "proName": "FOREXCOM:SPXUSD", "title": "S&P 500 Index" },
      { "proName": "FOREXCOM:NSXUSD", "title": "US 100 Cash CFD" },
      { "proName": "FX_IDC:EURUSD", "title": "EUR to USD" },
      { "proName": "BITSTAMP:BTCUSD", "title": "Bitcoin" },
      { "proName": "BITSTAMP:ETHUSD", "title": "Ethereum" },
      { "description": "VIX", "proName": "PEPPERSTONE:VIX" },
      { "description": "USD", "proName": "CAPITALCOM:DXY" },
      { "description": "NVDA", "proName": "NASDAQ:NVDA" },
      { "description": "Apple", "proName": "NASDAQ:AAPL" },
      { "description": "Yuan / USD", "proName": "FX_IDC:CNYUSD" },
      { "description": "USD / Japan", "proName": "OANDA:USDJPY" },
      { "description": "TOP 1% Holding Wealth", "proName": "FRED:WFRBLT01026" },
      { "description": "Bottom 50% HW", "proName": "FRED:WFRBSB50215" }
    ],
    "showSymbolLogo": true,
    "isTransparent": false,
    "displayMode": "adaptive",
    "colorTheme": "dark",
    "locale": "en"
  }
  </script>
</div>

<!-- 📛 HEADER -->
<h1>📊 Goldzilla Macro Dashboard</h1>

<!-- 🟨 Block 1: Gold & Silver -->
<div class="section" style="display: grid; grid-template-columns: repeat(3, 350px); gap: 8px; justify-content: start;">
  <div class="tradingview-widget-container">
    <div class="tradingview-widget-container__widget"></div>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>{"symbol": "TVC:GOLD", "width": 350, "isTransparent": false, "colorTheme": "dark", "locale": "en"}</script>
  </div>
  <div class="tradingview-widget-container">
    <div class="tradingview-widget-container__widget"></div>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>{"symbol": "TVC:SILVER", "width": 350, "isTransparent": false, "colorTheme": "dark", "locale": "en"}</script>
  </div>
  <div class="tradingview-widget-container">
    <div class="tradingview-widget-container__widget"></div>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>{"symbol": "TVC:USOIL", "width": 350, "isTransparent": false, "colorTheme": "dark", "locale": "en"}</script>
  </div>
  <div class="tradingview-widget-container">
    <div class="tradingview-widget-container__widget"></div>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>{"symbol": "CAPITALCOM:DXY", "width": 350, "isTransparent": false, "colorTheme": "dark", "locale": "en"}</script>
  </div>
</div>

<!-- 🟨 Block 3: Indices Grid (2x3) -->
<div class="section" style="display: grid; grid-template-columns: repeat(3, 350px); gap: 12px;">
  <div class="tradingview-widget-container">
    <div class="tradingview-widget-container__widget"></div>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>{"symbol": "FOREXCOM:SPXUSD", "width": 350, "isTransparent": false, "colorTheme": "dark", "locale": "en"}</script>
  </div>
  <div class="tradingview-widget-container">
    <div class="tradingview-widget-container__widget"></div>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>{"symbol": "FOREXCOM:DJI", "width": 350, "isTransparent": false, "colorTheme": "dark", "locale": "en"}</script>
  </div>
  <div class="tradingview-widget-container">
    <div class="tradingview-widget-container__widget"></div>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js" async>{"symbol": "FOREXCOM:NSXUSD", "width": 350, "isTransparent": false, "colorTheme": "dark", "locale": "en"}</script>
  </div>
</div>

<!-- 🟨 Block 4: Mag 7 + Sector Overview + News Feed -->
<div class="section" style="display: flex; gap: 20px; flex-wrap: wrap; align-items: flex-start;">
  <div class="tradingview-widget-container" style="min-width: 400px;">
    <div class="tradingview-widget-container__widget"></div>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>{"colorTheme":"dark","dateRange":"12M","showChart":true,"locale":"en","isTransparent":false,"showSymbolLogo":true,"width":"400","height":"650","tabs":[{"title":"Mag 7","symbols":[{"s":"NASDAQ:AAPL"},{"s":"NASDAQ:MSFT"},{"s":"NASDAQ:NVDA"},{"s":"NASDAQ:AMZN"},{"s":"NASDAQ:META"},{"s":"NASDAQ:GOOGL"},{"s":"NASDAQ:TSLA"}]}]}</script>
  </div>
  <div class="tradingview-widget-container" style="min-width: 400px;">
    <div class="tradingview-widget-container__widget"></div>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>{"colorTheme":"dark","dateRange":"12M","showChart":true,"locale":"en","isTransparent":false,"showSymbolLogo":true,"width":"400","height":"850","tabs":[{"title":"Sectors","symbols":[{"s":"AMEX:XLK"},{"s":"AMEX:XLI"},{"s":"AMEX:XLE"},{"s":"AMEX:XLB"},{"s":"AMEX:XLF"},{"s":"AMEX:XLV"},{"s":"AMEX:XLY"},{"s":"AMEX:XLP"},{"s":"AMEX:XLRE"},{"s":"AMEX:XLC"},{"s":"AMEX:XLU"}]}]}</script>
  </div>
  <div class="tradingview-widget-container" style="min-width: 400px;">
    <div class="tradingview-widget-container__widget"></div>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-timeline.js" async>{"feedMode":"all_symbols","isTransparent":false,"displayMode":"regular","width":400,"height":550,"colorTheme":"dark","locale":"en"}</script>
  </div>
</div>

<!-- 🟨 Block 5: Hotlists + Crypto Screener + Forex Panel -->
<div class="section" style="display: flex; gap: 20px; flex-wrap: wrap; align-items: flex-start;">
  <div class="tradingview-widget-container" style="min-width: 400px;">
    <div class="tradingview-widget-container__widget"></div>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-hotlists.js" async>{"colorTheme":"dark","dateRange":"12M","exchange":"US","showChart":true,"locale":"en","isTransparent":false,"showSymbolLogo":false,"showFloatingTooltip":false,"width":"400","height":"550"}</script>
  </div>
  <div class="tradingview-widget-container" style="min-width: 400px;">
    <div class="tradingview-widget-container__widget"></div>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-screener.js" async>{"width":"400","height":550,"defaultColumn":"overview","screener_type":"crypto_mkt","displayCurrency":"USD","colorTheme":"dark","locale":"en"}</script>
  </div>
  <div class="tradingview-widget-container" style="min-width: 400px;">
    <div class="tradingview-widget-container__widget"></div>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-quotes.js" async>{"width":550,"height":550,"symbolsGroups":[{"name":"Forex","originalName":"Forex","symbols":[{"name":"FX:EURUSD","displayName":"EUR to USD"},{"name":"FX:USDJPY","displayName":"USD to JPY"},{"name":"FX:USDCAD","displayName":"USD to CAD"},{"name":"SGX:CYN2025","displayName":"Chinese Yuan v USD"},{"name":"FX:USDCHF","displayName":"USD v Swissy"},{"name":"FX:USDMXN","displayName":"USD to MXN"}]}],"showSymbolLogo":true,"isTransparent":false,"colorTheme":"dark","locale":"en","backgroundColor":"#131722"}</script>
  </div>
</div>
<div class="section">
  <h2 style="color:#FF69B4;">💳 Household Debt Stress</h2>
  <div id="debt-data" style="color:white;">Loading data...</div>
</div>

<script>
  fetch("https://script.google.com/macros/s/AKfycbyqOIRdD09MMUyTOrWhPVFMyhnlvcDXKtN7wWjb6rTkIXHTlc1CHfANIvYVXasQAuaM/exec")
    .then(response => response.json())
    .then(data => {
      const container = document.getElementById("debt-data");

      // Filter valid rows with real data
      const filtered = data.filter(row =>
        row["Category"] &&
        (row["Q4 2023"] !== "" || row["Q4 2024"] !== "" || row["Q1 2025"] !== "")
      );

      let html = `<table style="width:100%; border-collapse:collapse; text-align:center; color:white;">
        <thead>
          <tr style="border-bottom:1px solid #666;">
            <th style="text-align:left;">Category</th>
            <th>Q4 2023</th>
            <th>Q4 2024</th>
            <th>Q1 2025</th>
            <th>↗️ Trend</th>
            <th>⚠️ Signal</th>
          </tr>
        </thead>
        <tbody>`;

      filtered.forEach(row => {
        const cat = row["Category"];
        const q4 = parseFloat(row["Q4 2024"]);
        const q1 = parseFloat(row["Q1 2025"]);

        // Determine trend
        let trend = "";
        if (!isNaN(q4) && !isNaN(q1)) {
          if (q1 > q4) trend = "🔺";
          else if (q1 < q4) trend = "🔻";
          else trend = "➡️";
        }

        // Determine signal
        let signal = "";
        if (q1 >= 7) signal = "🔴";      // High stress
        else if (q1 >= 3) signal = "🟠"; // Caution
        else if (q1 > 0)  signal = "🟢"; // Normal
        else signal = "";

        html += `
          <tr style="border-bottom: 1px solid #333;">
            <td style="text-align:left;">${cat}</td>
            <td>${row["Q4 2023"] ?? ""}</td>
            <td>${row["Q4 2024"] ?? ""}</td>
            <td>${row["Q1 2025"] ?? ""}</td>
            <td>${trend}</td>
            <td>${signal}</td>
          </tr>`;
      });

      html += `</tbody></table>`;
      container.innerHTML = html;
    })
    .catch(error => {
      console.error(error);
      document.getElementById("debt-data").innerHTML = "<span style='color:red;'>⚠️ Failed to load data.</span>";
    });
</script>
<div style="background-color: #111; color: #FFD700; padding: 20px; margin: 20px 0; border: 2px solid #FFD700; border-radius: 12px; font-family: Arial, sans-serif;">
  <h2 style="margin-top: 0;">📦 COMEX Gold Inventory Update</h2>
  <table style="width:100%; border-collapse: collapse; color: white; margin-top: 10px;">
    <thead>
      <tr style="border-bottom: 1px solid #FFD700;">
        <th style="text-align: left;">Metric</th>
        <th>Latest</th>
        <th>Change</th>
        <th>Signal</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>🔐 Registered</td>
        <td>21,319,411 oz</td>
        <td style="color: #0f0;">+62,011 oz</td>
        <td>🟠 Rising Delivery Demand</td>
      </tr>
      <tr>
        <td>🪙 Eligible</td>
        <td>17,469,782 oz</td>
        <td style="color: #f00;">−62,011 oz</td>
        <td>🟠 Physical Outflow</td>
      </tr>
      <tr>
        <td>📊 Combined Total</td>
        <td>38,789,194 oz</td>
        <td>0</td>
        <td>🟡 No Inventory Growth</td>
      </tr>
    </tbody>
  </table>
  <p style="margin-top: 15px; color: #ccc; font-size: 0.9em;">
    *Inventory shift from Eligible to Registered may indicate increased demand for physical delivery.
  </p>
</div>
<h2 style="color:gold; margin-top: 40px;">📉 Gold-to-Paper Ratio Stress Signal</h2>
import pandas as pd

import pandas as pd

# COMEX data from 5/14/2025 to 5/30/2025
data = [
    {"Date": "2025-05-14", "OI": 441565, "RegisteredGold_oz": None},
    {"Date": "2025-05-15", "OI": 440192, "RegisteredGold_oz": None},
    {"Date": "2025-05-16", "OI": 441666, "RegisteredGold_oz": None},
    {"Date": "2025-05-19", "OI": 442943, "RegisteredGold_oz": None},
    {"Date": "2025-05-20", "OI": 448688, "RegisteredGold_oz": None},
    {"Date": "2025-05-21", "OI": 453813, "RegisteredGold_oz": None},
    {"Date": "2025-05-22", "OI": 459353, "RegisteredGold_oz": None},
    {"Date": "2025-05-23", "OI": 458101, "RegisteredGold_oz": None},
    {"Date": "2025-05-27", "OI": 440621, "RegisteredGold_oz": 21380763.98},
    {"Date": "2025-05-28", "OI": 431409, "RegisteredGold_oz": None},
    {"Date": "2025-05-29", "OI": 422605, "RegisteredGold_oz": None},
    {"Date": "2025-05-30", "OI": 410976, "RegisteredGold_oz": 21319411.78},
]

# Assume 100 oz per futures contract
contract_size_oz = 100

# Create DataFrame
df = pd.DataFrame(data)

# Forward fill registered gold where missing
df["RegisteredGold_oz"] = df["RegisteredGold_oz"].ffill()

# Calculate Gold-to-Paper Ratio
df["OpenInterest_oz"] = df["OI"] * contract_size_oz
df["GoldToPaperRatio"] = df["OpenInterest_oz"] / df["RegisteredGold_oz"]

# Assign signal
def classify_ratio(ratio):
    if ratio < 2:
        return "🟢 Stable"
    elif 2 <= ratio < 2.5:
        return "🟠 Elevated"
    elif 2.5 <= ratio < 3:
        return "🔴 High Stress"
    else:
        return "☠️ Critical"

df["Signal"] = df["GoldToPaperRatio"].apply(classify_ratio)

import ace_tools as tools; tools.display_dataframe_to_user(name="Gold-to-Paper Stress Signal", dataframe=df[["Date", "OI", "RegisteredGold_oz", "GoldToPaperRatio", "Signal"]])
